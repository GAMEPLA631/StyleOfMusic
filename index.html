<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Musical Universe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js Library for 3D Wallpaper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Inter:wght@400;700&display=swap');
        
        /* Basic body styles for a modern, dark look */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0a0a0a;
            color: #f0f0f0;
            line-height: 1.6;
            overflow-x: hidden;
            /* Dôležité: zabezpečuje, že obsah bude nad 3D tapetou */
            position: relative; 
            z-index: 1;
        }

        /* 3D Wallpaper Canvas Styles - celá obrazovka, fixné, za obsahom */
        #threejs-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Zabezpečuje, že je za obsahom */
            pointer-events: none; /* Umožňuje prekliknutie na obsah stránky */
            opacity: 0.5; /* Mierne stlmené, aby nebolo príliš rušivé */
        }
        
        /* Container for the entire page */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            position: relative; /* Pre zachovanie z-index 1 */
        }

        /* Hero section for an engaging introduction */
        .hero-section {
            background: linear-gradient(to right, #1a1a1a, #2c2c2c);
            padding: 6rem 2rem;
            border-radius: 1rem;
            text-align: center;
            margin-bottom: 3rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        /* Grid for genre cards */
        .genre-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }
        
        /* Styling and animation for genre cards */
        .genre-card {
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            transition: transform 0.4s ease-in-out, box-shadow 0.4s ease-in-out;
            opacity: 0;
            transform: translateY(30px);
            border: 2px solid transparent;
        }
        
        /* Color gradients for cards */
        .grad-1 { background-image: linear-gradient(135deg, #FF6B6B, #F88A6A); }
        .grad-2 { background-image: linear-gradient(135deg, #51A8E8, #7DE2D1); }
        .grad-3 { background-image: linear-gradient(135deg, #A87DFF, #D18CEB); }
        .grad-4 { background-image: linear-gradient(135deg, #F9D423, #F64F59); }
        .grad-5 { background-image: linear-gradient(135deg, #20E3B2, #6C5B7B); }
        .grad-6 { background-image: linear-gradient(135deg, #B993D6, #8CA6DB); }
        .grad-7 { background-image: linear-gradient(135deg, #FFDAB9, #FFC0CB); }
        
        /* Animation when the card is visible */
        .genre-card.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Hover effect */
        .genre-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            border-color: #8c7ae6;
        }

        .genre-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.75rem;
        }

        .genre-description {
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            color: #f0f0f0;
            line-height: 1.5;
            opacity: 0.8;
        }

        /* Chat section styles */
        .chat-section {
            background-color: #1a1a1a;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            margin-top: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .chat-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .chat-box {
            height: 400px;
            overflow-y: auto;
            background-color: #0d0d0d;
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Hide scrollbar on WebKit browsers */
        .chat-box::-webkit-scrollbar {
            display: none;
        }

        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            white-space: pre-wrap;
            position: relative;
        }

        .message.user {
            background-color: #51A8E8;
            color: #1a1a1a;
            align-self: flex-end;
            text-align: right;
            border-bottom-right-radius: 0.25rem;
        }

        .message.ai {
            background-color: #2c2c2c;
            color: #f0f0f0;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .message-text {
            word-wrap: break-word;
        }

        .copy-button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: #51A8E8;
            color: #1a1a1a;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
        }

        .copy-button:hover {
            background-color: #3f87c2;
            transform: translateY(-1px);
        }

        .copy-button.copied {
            background-color: #20E3B2;
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            background-color: #2c2c2c;
            border: 2px solid #3d3d3d;
            color: #f0f0f0;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #51A8E8;
        }

        .generate-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #A87DFF, #D18CEB);
            color: #ffffff;
            font-weight: 700;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .generate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #A87DFF;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 3D Background Canvas -->
    <canvas id="threejs-canvas"></canvas>

    <!-- Wallpaper Control Button - Z-index 20 zabezpečí, že bude vždy navrchu -->
    <button id="toggle-wallpaper" class="fixed bottom-4 right-4 z-20 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-full shadow-lg transition duration-300">
        Zmeniť Tapetu
    </button>
    
    <div class="container">
        <!-- Engaging hero section with title and subtitle -->
        <header class="hero-section">
            <h1 class="text-5xl md:text-6xl font-bold mb-4 text-white drop-shadow-md">The Musical Universe</h1>
            <p class="text-lg md:text-xl text-gray-300">Explore the endless palette of genres and their unique stories.</p>
        </header>

        <div class="genre-list" id="genre-container">
            <!-- Cards will be generated with JavaScript, each with its own description -->
        </div>

        <!-- Chat section -->
        <section class="chat-section">
            <h2 class="chat-title">Generate Music Lyrics with AI</h2>
            <div id="chat-box" class="chat-box">
                <!-- Messages will appear here -->
            </div>
            <div class="chat-input-container">
                <input type="text" id="prompt-input" class="chat-input" placeholder="Enter your music genre or idea...">
                <button id="generate-button" class="generate-button">Generate</button>
                <div id="loading-spinner" class="loading-spinner"></div>
            </div>
        </section>
    </div>

    <script>
        const styles = [
            "Bass Boosted",
            "Horrorcore", "Dark Ambient", "Drone", "Industrial", "Gothic Metal", 
            "Doom Metal", "Black Metal", "Death Industrial", "Power Electronics", "Noise",
            "Bass Boosted Trap", "Future Bass Drop", "Hardstyle Bass", "Dubstep Wobble",
            "Vaporwave", "Synthwave", "Lofi Hip Hop", "Ambient", "Post-Rock", "Shoegaze",
            "Chillwave", "Trip Hop", "Reggaeton", "Jungle",
            "Ska Punk", "Gospel", "Celtic Music", "Minimalism", "Baroque Pop", "K-Pop", "Samba", "Flamenco", "Opera",
            // Energetické štýly
            "Hardcore Punk", "Drum and Bass", "Speedcore", "Power Metal",
            "Metalcore Dark", 
            // NOVÝ ŠTÝL ZADANÝ UŽÍVATEĽOM
            "Aggressive Bass Boosted Energy" 
        ];

        const descriptions = {
            "Bass Boosted": "Music specifically mixed and mastered to be played on powerful car audio systems, with a focus on deep, rumbling bass.",
            "Horrorcore": "A blend of hip hop with horror themes, often featuring violent lyrics, eerie samples, and dark beats.",
            "Dark Ambient": "Minimalistic and atmospheric music that creates a sense of dread, desolation, and unease.",
            "Drone": "Music characterized by sustained tones or sound clusters, creating a hypnotic and often unsettling atmosphere.",
            "Industrial": "A genre using harsh, abrasive sounds, often created from industrial equipment and electronic loops, to create a tense and cold atmosphere.",
            "Gothic Metal": "A fusion of heavy metal with the dark, melancholic elements of gothic rock, including dramatic vocals and gloomy melodies.",
            "Doom Metal": "Extremely slow and heavy metal music known for its gloomy, oppressive, and pessimistic themes.",
            "Black Metal": "An extreme subgenre of metal defined by fast tempos, raw recording, and screeching vocals, often with themes of darkness and evil.",
            "Death Industrial": "A genre combining the harsh soundscapes of industrial music with the dark, morbid themes of death and decay.",
            "Power Electronics": "An extreme genre known for its distorted vocals and harsh, static noise, creating an aggressive and chaotic sound.",
            "Noise": "Music characterized by the use of dissonant and often unsettling sounds, focusing on the texture and quality of noise itself.",
            "Bass Boosted Trap": "A subgenre of Trap music where the primary focus is on extremely low-frequency sub-bass, often with distorted and heavy 808s.",
            "Future Bass Drop": "Characterized by its signature 'drop' and a heavy, melodic bass line, often featuring wobbles and digital synth sounds.",
            "Hardstyle Bass": "Known for its powerful and distorted kick drum, combined with raw, high-energy basslines that drive the track.",
            "Dubstep Wobble": "Defined by its iconic 'wobble bass' sound, which is created by modulating the bassline, providing a rhythmic and pulsating feel.",
            "Vaporwave": "A microgenre of electronic music with a nostalgic, surreal aesthetic, often incorporating slowed-down, pitch-shifted samples of smooth jazz and lounge music.",
            "Synthwave": "A retro-futuristic genre inspired by 1980s film soundtracks and video games, featuring synthesizers and a nostalgic, vibrant sound.",
            "Lofi Hip Hop": "A relaxing genre with muted, downtempo beats and often subtle background noise, ideal for studying or unwinding.",
            "Ambient": "A genre focused on atmosphere and tone over traditional musical structure, creating a sense of calm and space.",
            "Post-Rock": "Instrumental music that uses rock instrumentation and song structure but avoids typical rock conventions, focusing on building dramatic soundscapes.",
            "Shoegaze": "A subgenre of alternative rock characterized by a fusion of obscured vocals, distorted guitars, and overwhelming sound.",
            "Chillwave": "A style of electronic music with a lo-fi, hazy sound, often featuring relaxed rhythms and nostalgic synth melodies.",
            "Trip Hop": "A downtempo electronic genre that blends hip hop rhythms with a dark, cinematic, and atmospheric sound.",
            "Reggaeton": "A genre originating in Puerto Rico, blending Jamaican dancehall with Latin American and hip hop rhythms.",
            "Jungle": "A fast-paced genre of electronic music characterized by breakbeats, heavy basslines, and samples.",
            "Ska Punk": "A fusion of the energetic, upbeat rhythms of ska with the aggressive and fast-paced nature of punk rock.",
            "Gospel": "Music written to express personal or communal belief in Christian life, often featuring powerful vocals and spiritual themes.",
            "Celtic Music": "A broad genre encompassing traditional music from Celtic nations such as Ireland, Scotland, and Wales, known for its use of fiddles, flutes, and bagpipes.",
            "Minimalism": "Characterized by a repetitive, hypnotic feel, often using simple melodic and rhythmic ideas that are repeated and slowly changed over time.",
            "Baroque Pop": "A subgenre of pop and rock music that incorporates elements of classical music, such as strings, harpsichord, and multi-part vocal harmonies.",
            "K-Pop": "A form of popular music originating in South Korea, often featuring a blend of diverse genres like pop, hip hop, R&B, and EDM.",
            "Samba": "A Brazilian musical genre and dance style known for its rhythmic, lively beat and often celebratory themes.",
            "Flamenco": "A traditional Spanish art form involving soulful singing, intricate guitar playing, and passionate dance.",
            "Opera": "A dramatic stage work in which all or most of the text is sung, accompanied by an orchestra, combining music, theater, and sometimes dance.",
            // Popisy pre energetické štýly
            "Hardcore Punk": "Extrémne rýchly a agresívny subžáner punku, často s krátkymi piesňami a surovým zvukom.",
            "Drum and Bass": "Vysokoenergetický žáner elektronickej hudby, charakteristický rýchlymi bicími slučkami a hlbokými basmi.",
            "Speedcore": "Extrémne rýchly a intenzívny štýl elektronickej hudby, s tempom často presahujúcim 300 úderov za minútu.",
            "Power Metal": "Subžáner heavy metalu, známy pre svoje rýchle melódie, melodické vokaly a fantasy témy.",
            "Metalcore Dark": "A mix of heavy guitar riffs, fast drums, and melodic yet aggressive choruses, with screams/growls in the verses.",
            // NOVÝ POPIS
            "Aggressive Bass Boosted Energy": "A chaotic fusion blending Brutal Bass, Dubstep, Hardstyle, Neurostep, and Ravecore. Defined by its heavy, dark, explosive sound for peak festival energy and chaos." 
        };

        const container = document.getElementById('genre-container');
        const colorClasses = ["grad-1", "grad-2", "grad-3", "grad-4", "grad-5", "grad-6", "grad-7"];

        // Generate genre cards with dynamic descriptions and color gradients
        for (let i = 0; i < styles.length; i++) {
            const style = styles[i]; 
            const description = descriptions[style] || "This is a long, but fictional description that characterizes the musical genre and its atmosphere. It is just placeholder text to fill the space and make the card look fuller and more professional.";
            const colorClass = colorClasses[i % colorClasses.length];
            
            const cardHtml = `
                <div class="genre-card ${colorClass}">
                    <h2 class="genre-title">${style}</h2>
                    <p class="genre-description">${description}</p>
                </div>
            `;
            container.innerHTML += cardHtml;
        }

        // Animation for cards on scroll
        const cards = document.querySelectorAll('.genre-card');
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        cards.forEach(card => {
            observer.observe(card);
        });

        // Chat logic
        const promptInput = document.getElementById('prompt-input');
        const generateButton = document.getElementById('generate-button');
        const chatBox = document.getElementById('chat-box');
        const loadingSpinner = document.getElementById('loading-spinner');

        // *** INSERT YOUR API KEY HERE ***
        const apiKey = "AIzaSyAzWkdCBiqlrFZODs2zEichlIWe68Wo2eI";
        
        // Function to add a message to the chat
        const addMessage = (text, sender) => {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            
            const textContentDiv = document.createElement('div');
            textContentDiv.classList.add('message-text');
            textContentDiv.innerHTML = text.replace(/\n/g, '<br>');
            messageDiv.appendChild(textContentDiv);

            // Only add a copy button for AI messages
            if (sender === 'ai') {
                const copyButton = document.createElement('button');
                copyButton.textContent = 'Kopírovať';
                copyButton.classList.add('copy-button');
                
                copyButton.addEventListener('click', () => {
                    // Fallback pre staršie prehliadače, ak navigator.clipboard nie je k dispozícii
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => {
                            copyButton.textContent = 'Skopírované!';
                            copyButton.classList.add('copied');
                            setTimeout(() => {
                                copyButton.textContent = 'Kopírovať';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy text: ', err);
                        });
                    } else {
                        // Starší, ale spoľahlivejší spôsob kopírovania
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            copyButton.textContent = 'Skopírované!';
                            copyButton.classList.add('copied');
                            setTimeout(() => {
                                copyButton.textContent = 'Kopírovať';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy text: ', err);
                        }
                        document.body.removeChild(textArea);
                    }
                });
                messageDiv.appendChild(copyButton);
            }
            
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        // Function to send a request to the Gemini API
        const generateText = async () => {
            const userPrompt = promptInput.value.trim();
            if (!userPrompt) return;

            addMessage(userPrompt, 'user');
            promptInput.value = '';
            
            loadingSpinner.style.display = 'block';
            generateButton.disabled = true;

            const structuredPrompt = `Generate a musical lyrical narrative based on the user's idea. The output must follow this exact structure, including the section titles in brackets:

[Intro]
A brief, atmospheric opening.
[Verse 1]
Develop the first part of the story or theme.
[Build-up]
Increase tension or energy, leading into the main section.
[Drop]
The climactic, most impactful part of the song.
[Verse 2]
Further develop the narrative or introduce a new perspective.
[Bridge]
A contrasting section that provides a change of pace or mood.
[Final Build]
A second build that brings the song towards its conclusion.
[Final Drop]
The final, powerful conclusion of the song, often with a final line or a sound effect.

User's idea: ${userPrompt}
`;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: structuredPrompt }] }],
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                const aiText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (aiText) {
                    addMessage(aiText, 'ai');
                } else {
                    addMessage("Sorry, I couldn't generate a response. Please try again.", 'ai');
                }

            } catch (error) {
                console.error("Error generating content:", error);
                addMessage("An error occurred. Please check your API key and try again.", 'ai');
            } finally {
                loadingSpinner.style.display = 'none';
                generateButton.disabled = false;
            }
        };


        // --- LOGIKA 3D TAPETY (Three.js) - Kozmické a Magické Režimy ---

        const canvas = document.getElementById('threejs-canvas');
        const toggleButton = document.getElementById('toggle-wallpaper');

        // Deklarácia premenných vrátane planét
        let scene, camera, renderer, particles, geometry, material, torusKnot, pointLight, planet1, planet2;
        let currentMode = 'nebula'; // Predvolený režim je teraz 'nebula'
        let clock = new THREE.Clock();

        function initThreeJS() {
            // 1. Scéna
            scene = new THREE.Scene();

            // 2. Kamera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // 3. Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setClearColor(0x000000, 0); // Priehľadné pozadie

            // Osvetlenie
            // Zvýšená intenzita pre lepší magický a kozmický efekt
            const ambientLight = new THREE.AmbientLight(0x404040, 10); 
            scene.add(ambientLight);
            
            // Bodové svetlo pre Torus Knot (Magický Uzol)
            pointLight = new THREE.PointLight(0x7DE2D1, 15, 100);
            pointLight.position.set(5, 5, 5);
            pointLight.visible = false; // Začiatok neviditeľný, kým sa neprepne na Magický Uzol
            scene.add(pointLight);

            createCosmicNebula(); // Inicializácia predvoleného režimu
            
            // Nastavenie pre zmenu veľkosti okna
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Režim 1: Kozmická Hmla (Cosmic Nebula Mode) s planétami
        function createCosmicNebula() {
            if (torusKnot) scene.remove(torusKnot);
            if (pointLight) pointLight.visible = false; // Skryť svetlo

            // Zviditeľniť planéty, ak už boli vytvorené
            if (planet1) planet1.visible = true;
            if (planet2) planet2.visible = true;

            // ----------------------------------------------------
            // ČASTICE (Hmlovina)
            // ----------------------------------------------------
            if (particles) {
                scene.add(particles);
            } else {
                geometry = new THREE.BufferGeometry();
                const vertices = [];
                const colors = [];
                const particleCount = 5000;
                
                const color = new THREE.Color();

                for (let i = 0; i < particleCount; i++) {
                    // Širšie rozloženie častíc pre efekt hmloviny/galaxie
                    const x = (Math.random() - 0.5) * 400;
                    const y = (Math.random() - 0.5) * 400;
                    const z = (Math.random() - 0.5) * 400;
                    vertices.push(x, y, z);
                    
                    // Náhodné farby v spektre modrej, fialovej a tyrkysovej
                    color.setHSL(Math.random() * 0.1 + 0.6, 0.7, 0.7); 
                    colors.push(color.r, color.g, color.b);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                
                material = new THREE.PointsMaterial({ 
                    size: 0.5, 
                    vertexColors: true, 
                    transparent: true,
                    opacity: 0.8,
                    sizeAttenuation: true 
                });

                particles = new THREE.Points(geometry, material);
                scene.add(particles);
            }
            
            // ----------------------------------------------------
            // PLANÉTY (Magický kozmický vzhľad)
            // ----------------------------------------------------
            if (!planet1) {
                // Planeta 1: Magický, žiariaci plyn
                const geo1 = new THREE.SphereGeometry(1.0, 32, 32);
                // Emissive material pre žiariaci efekt
                const mat1 = new THREE.MeshStandardMaterial({
                    color: 0x98FF98, // Svetlozelená/Tyrkysová
                    emissive: 0x32CD32, // Žiariaca zelená
                    emissiveIntensity: 2.0, // Silná žiara
                    metalness: 0.1,
                    roughness: 0.8
                });
                planet1 = new THREE.Mesh(geo1, mat1);
                planet1.position.set(-10, 5, -20);
                scene.add(planet1);

                // Planeta 2: Vzdialená, chladná modrá
                const geo2 = new THREE.SphereGeometry(0.6, 32, 32);
                const mat2 = new THREE.MeshStandardMaterial({
                    color: 0x87CEEB, // Svetlomodrá
                    emissive: 0x00BFFF, // Hlboká modrá žiara
                    emissiveIntensity: 1.0,
                    metalness: 0.5,
                    roughness: 0.4
                });
                planet2 = new THREE.Mesh(geo2, mat2);
                planet2.position.set(15, -10, -35);
                scene.add(planet2);
            }
            
            currentMode = 'nebula';
            toggleButton.textContent = 'Zmeniť Tapetu: Magický Uzol';
        }

        // Režim 2: Magický Uzol (Torus Knot Mode)
        function createTorusKnot() {
            if (particles) scene.remove(particles);
            if (pointLight) pointLight.visible = true; // Zobraziť svetlo
            
            // Skryť planéty pri prepnutí na Magický Uzol
            if (planet1) planet1.visible = false;
            if (planet2) planet2.visible = false;

            // Ak už existuje, len ho vrátime
            if (torusKnot) {
                scene.add(torusKnot);
            } else {
                // Torus Knot je komplexná, magicky vyzerajúca geometria
                const geometry = new THREE.TorusKnotGeometry(1.5, 0.5, 100, 16);
                
                // MeshStandardMaterial pre lesklý, kovový/magický vzhľad
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0xA87DFF, // Fialová
                    metalness: 0.8,
                    roughness: 0.2,
                    transparent: true,
                    opacity: 0.9,
                    emissive: 0x51A8E8, // Modrá žiara
                    emissiveIntensity: 0.5 
                }); 
                torusKnot = new THREE.Mesh(geometry, material);
                scene.add(torusKnot);
            }
            currentMode = 'torus';
            toggleButton.textContent = 'Zmeniť Tapetu: Kozmická Hmla';
        }

        function toggleWallpaper() {
            // Prepnutie medzi režimami
            if (currentMode === 'nebula') {
                createTorusKnot();
            } else {
                createCosmicNebula();
            }
        }

        // Animačná slučka
        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            const elapsedTime = clock.getElapsedTime();

            if (currentMode === 'nebula' && particles) {
                // Rotácia hmloviny pre dynamický vesmírny pocit
                particles.rotation.y += 0.0001;
                particles.rotation.x = Math.sin(elapsedTime * 0.05) * 0.1;

                // Mierne "dýchanie" kamery pre pocit pohybu
                camera.position.z = 5 + Math.sin(elapsedTime * 0.5) * 0.5;

                // Pohyb a rotácia planét pre magický kozmický efekt
                if (planet1 && planet1.visible) {
                    planet1.rotation.y += 0.005;
                    // Planéta 1 sa pomaly posúva a osciluje
                    planet1.position.x = Math.sin(elapsedTime * 0.1) * 10 - 5;
                    planet1.position.y = Math.cos(elapsedTime * 0.1) * 5 + 5;
                }

                if (planet2 && planet2.visible) {
                    // Planéta 2 sa len pomaly otáča
                    planet2.rotation.y -= 0.003;
                    planet2.rotation.x += 0.001;
                }

            } else if (currentMode === 'torus' && torusKnot) {
                // Magická rotácia uzla
                torusKnot.rotation.x += 0.1 * delta;
                torusKnot.rotation.y += 0.2 * delta;
                
                // Pomalé farebné pulzovanie emisívnej (žiariacej) zložky
                const hue = (Math.sin(elapsedTime * 0.5) * 0.5 + 0.5); // 0 do 1
                torusKnot.material.emissive.setHSL(hue * 0.2 + 0.6, 1, 0.7); // Tón modrej/fialovej
                
                // Pohyb svetla okolo uzla (magický efekt)
                if (pointLight) {
                    pointLight.position.x = Math.sin(elapsedTime * 0.7) * 7;
                    pointLight.position.y = Math.cos(elapsedTime * 0.7) * 7;
                }
            }
            
            renderer.render(scene, camera);
        }

        // Inicializácia pri načítaní okna
        window.onload = function () {
            // Inicializácia Three.js
            if (typeof THREE !== 'undefined') {
                initThreeJS();
                animate();
                toggleButton.addEventListener('click', toggleWallpaper);
            } else {
                console.error("Three.js nebol načítaný.");
            }

            // Existujúce event listenery pre chat a karty:
            cards.forEach(card => {
                observer.observe(card);
            });

            generateButton.addEventListener('click', generateText);
            promptInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateText();
                }
            });
        };
    </script>
</body>
</html>















